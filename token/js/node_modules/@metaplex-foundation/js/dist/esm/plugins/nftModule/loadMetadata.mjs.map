{"version":3,"file":"loadMetadata.mjs","sources":["../../../../src/plugins/nftModule/loadMetadata.ts"],"sourcesContent":["import { Metaplex } from '@/Metaplex';\nimport { Operation, useOperation, OperationHandler } from '@/types';\nimport { DisposableScope } from '@/utils';\nimport { LazyMetadata, Metadata } from './Metadata';\nimport { JsonMetadata } from './JsonMetadata';\n\n// -----------------\n// Operation\n// -----------------\n\nconst Key = 'LoadMetadataOperation' as const;\nexport const loadMetadataOperation = useOperation<LoadMetadataOperation>(Key);\nexport type LoadMetadataOperation = Operation<\n  typeof Key,\n  LoadMetadataInput,\n  Metadata\n>;\n\nexport type LoadMetadataInput = {\n  metadata: LazyMetadata;\n};\n\n// -----------------\n// Handler\n// -----------------\n\nexport const loadMetadataOperationHandler: OperationHandler<LoadMetadataOperation> =\n  {\n    handle: async (\n      operation: LoadMetadataOperation,\n      metaplex: Metaplex,\n      scope: DisposableScope\n    ): Promise<Metadata> => {\n      const { metadata } = operation.input;\n\n      try {\n        const json = await metaplex\n          .storage()\n          .downloadJson<JsonMetadata>(metadata.uri, scope);\n        return { ...metadata, lazy: false, json };\n      } catch (error) {\n        return { ...metadata, lazy: false, json: null };\n      }\n    },\n  };\n"],"names":["Key","loadMetadataOperation","useOperation","loadMetadataOperationHandler","handle","operation","metaplex","scope","metadata","input","json","storage","downloadJson","uri","lazy","error"],"mappings":";;AAMA;AACA;AACA;AAEA,MAAMA,GAAG,GAAG,uBAAZ,CAAA;MACaC,qBAAqB,GAAGC,YAAY,CAAwBF,GAAxB,EAA1C;AAWP;AACA;AACA;AAEO,MAAMG,4BAAqE,GAChF;AACEC,EAAAA,MAAM,EAAE,OACNC,SADM,EAENC,QAFM,EAGNC,KAHM,KAIgB;IACtB,MAAM;AAAEC,MAAAA,QAAAA;KAAaH,GAAAA,SAAS,CAACI,KAA/B,CAAA;;IAEA,IAAI;AACF,MAAA,MAAMC,IAAI,GAAG,MAAMJ,QAAQ,CACxBK,OADgB,EAAA,CAEhBC,YAFgB,CAEWJ,QAAQ,CAACK,GAFpB,EAEyBN,KAFzB,CAAnB,CAAA;MAGA,OAAO,EAAE,GAAGC,QAAL;AAAeM,QAAAA,IAAI,EAAE,KAArB;AAA4BJ,QAAAA,IAAAA;OAAnC,CAAA;KAJF,CAKE,OAAOK,KAAP,EAAc;MACd,OAAO,EAAE,GAAGP,QAAL;AAAeM,QAAAA,IAAI,EAAE,KAArB;AAA4BJ,QAAAA,IAAI,EAAE,IAAA;OAAzC,CAAA;AACD,KAAA;AACF,GAAA;AAhBH;;;;"}