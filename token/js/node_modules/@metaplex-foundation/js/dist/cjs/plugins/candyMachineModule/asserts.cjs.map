{"version":3,"file":"asserts.cjs","sources":["../../../../src/plugins/candyMachineModule/asserts.ts"],"sourcesContent":["import { Creator } from '@metaplex-foundation/mpl-token-metadata';\nimport { assert } from '@/utils';\nimport {\n  MAX_CREATOR_LIMIT,\n  MAX_NAME_LENGTH,\n  MAX_SYMBOL_LENGTH,\n  MAX_URI_LENGTH,\n} from './constants';\nimport { CandyMachine } from './CandyMachine';\nimport {\n  CandyMachineAddItemConstraintsViolatedError,\n  CandyMachineCannotAddAmountError,\n  CandyMachineEndedError,\n  CandyMachineIsEmptyError,\n  CandyMachineIsFullError,\n  CandyMachineNotLiveError,\n} from './errors';\nimport {\n  ConfigLine,\n  EndSettingType,\n} from '@metaplex-foundation/mpl-candy-machine';\nimport { BigNumber, now, Signer, toBigNumber } from '@/types';\n\nexport const assertName = (name: string) => {\n  assert(\n    name.length <= MAX_NAME_LENGTH,\n    `Candy Machine name too long: ${name} (max ${MAX_NAME_LENGTH})`\n  );\n};\n\nexport const assertSymbol = (symbol: string) => {\n  assert(\n    symbol.length <= MAX_SYMBOL_LENGTH,\n    `Candy Machine symbol too long: ${symbol} (max ${MAX_SYMBOL_LENGTH})`\n  );\n};\n\nexport const assertUri = (uri: string) => {\n  assert(\n    uri.length <= MAX_URI_LENGTH,\n    `Candy Machine URI too long: ${uri} (max ${MAX_URI_LENGTH})`\n  );\n};\n\nexport const assertCreators = (creators: Creator[]) => {\n  assert(\n    creators.length <= MAX_CREATOR_LIMIT,\n    `Candy Machine creators too long: ${creators} (max ${MAX_CREATOR_LIMIT})`\n  );\n};\n\nexport const assertNotFull = (candyMachine: CandyMachine, index: BigNumber) => {\n  if (candyMachine.isFullyLoaded) {\n    throw new CandyMachineIsFullError(index, candyMachine.itemsAvailable);\n  }\n};\n\nexport const assertNotEmpty = (candyMachine: CandyMachine) => {\n  if (candyMachine.itemsRemaining.isZero()) {\n    throw new CandyMachineIsEmptyError(candyMachine.itemsAvailable);\n  }\n};\n\nexport const assertCanAdd = (\n  candyMachine: CandyMachine,\n  index: BigNumber,\n  amount: number\n) => {\n  if (index.addn(amount).gt(candyMachine.itemsAvailable)) {\n    throw new CandyMachineCannotAddAmountError(\n      index,\n      amount,\n      candyMachine.itemsAvailable\n    );\n  }\n};\n\nexport const assertAllConfigLineConstraints = (configLines: ConfigLine[]) => {\n  for (let i = 0; i < configLines.length; i++) {\n    try {\n      assertName(configLines[i].name);\n      assertUri(configLines[i].uri);\n    } catch (err: any) {\n      throw new CandyMachineAddItemConstraintsViolatedError(\n        toBigNumber(i),\n        configLines[i],\n        err\n      );\n    }\n  }\n};\n\nexport const assertCandyMachineIsLive = (candyMachine: CandyMachine) => {\n  const hasWhitelistPresale =\n    candyMachine.whitelistMintSettings?.presale ?? false;\n\n  if (hasWhitelistPresale) {\n    return;\n  }\n\n  const liveDate = candyMachine.goLiveDate;\n\n  if (!liveDate || liveDate.gte(now())) {\n    throw new CandyMachineNotLiveError(liveDate);\n  }\n};\n\nexport const assertCandyMachineHasNotEnded = (candyMachine: CandyMachine) => {\n  const endSettings = candyMachine.endSettings;\n\n  if (!endSettings) {\n    return;\n  }\n\n  const hasEndedByAmount =\n    endSettings.endSettingType === EndSettingType.Amount &&\n    candyMachine.itemsMinted.gte(endSettings.number);\n  const hasEndedByDate =\n    endSettings.endSettingType === EndSettingType.Date &&\n    endSettings.date.lt(now());\n\n  if (hasEndedByAmount || hasEndedByDate) {\n    throw new CandyMachineEndedError(endSettings);\n  }\n};\n\nexport const assertCanMintCandyMachine = (\n  candyMachine: CandyMachine,\n  payer: Signer\n) => {\n  assertNotEmpty(candyMachine);\n\n  if (candyMachine.authorityAddress.equals(payer.publicKey)) {\n    return;\n  }\n\n  assertCandyMachineIsLive(candyMachine);\n  assertCandyMachineHasNotEnded(candyMachine);\n};\n"],"names":["assertName","name","assert","length","MAX_NAME_LENGTH","assertUri","uri","MAX_URI_LENGTH","assertNotFull","candyMachine","index","isFullyLoaded","CandyMachineIsFullError","itemsAvailable","assertNotEmpty","itemsRemaining","isZero","CandyMachineIsEmptyError","assertCanAdd","amount","addn","gt","CandyMachineCannotAddAmountError","assertAllConfigLineConstraints","configLines","i","err","CandyMachineAddItemConstraintsViolatedError","toBigNumber","assertCandyMachineIsLive","hasWhitelistPresale","whitelistMintSettings","presale","liveDate","goLiveDate","gte","now","CandyMachineNotLiveError","assertCandyMachineHasNotEnded","endSettings","hasEndedByAmount","endSettingType","EndSettingType","Amount","itemsMinted","number","hasEndedByDate","Date","date","lt","CandyMachineEndedError","assertCanMintCandyMachine","payer","authorityAddress","equals","publicKey"],"mappings":"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"}